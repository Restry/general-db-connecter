{"version":3,"sources":["../../../src/utils/db.js"],"names":["config","dbUrl","process","env","NODE_ENV","mongoClient","require","MongoClient","Promise","db","instance","Singleton","database","url","resolve","reject","connect","useNewUrlParser","useUnifiedTopology","err","_static","name","args","undefined","console","log","module","exports"],"mappings":";;AAEA,IAAMA,SAAS;AACbC,SAAO,yJADM,CACoJ;AACjK;;AAFa,CAAf;;AAMA,IAAIC,QAAQC,GAAR,CAAYC,QAAZ,KAAyB,aAA7B,EAA4C;AAC1C;AACA;AACAJ,SAAOC,KAAP,GAAe,yJAAf;AACD;AACD;;AAEA,IAAMI,cAAcC,QAAQ,SAAR,EAAmBC,WAAvC;AACA,IAAIC,UAAUF,QAAQ,UAAR,CAAd;;AAEA,IAAIG,KAAM,YAAY;AACpB;AACA,MAAIC,QAAJ;;AAEA,WAASC,SAAT,CAAmBC,QAAnB,EAA6B;AAC3B,QAAIC,MAAMb,OAAOC,KAAjB;AACA;AACA,WAAO,IAAIO,OAAJ,CAAY,UAACM,OAAD,EAAUC,MAAV,EAAqB;AACtC;;AAEAV,kBAAYW,OAAZ,CAAoBH,GAApB,EAAyB,EAAEI,iBAAiB,IAAnB,EAAyBC,oBAAoB,IAA7C,EAAzB,EACE,UAACC,GAAD,EAAMV,EAAN,EAAa;AACX,YAAIU,GAAJ,EAAS;AACPJ,iBAAOI,GAAP;AACA;AACD,SAHD,MAGO;AACLT,qBAAWD,GAAGA,EAAH,CAAMG,QAAN,CAAX;AACAE,kBAAQJ,QAAR,EAAkBD,EAAlB;AACD;AACF,OATH;AAUD,KAbM,CAAP;AAcD;;AAGD,MAAIW,UAAU;AACZC,UAAM,uBADM;;AAGZ;AACA;AACAL,aAAS,iBAAUM,IAAV,EAAgB;AACvB,UAAIZ,aAAaa,SAAjB,EAA4B;AAC1BC,gBAAQC,GAAR,0BAAmCH,IAAnC;AACA,eAAO,IAAIX,SAAJ,CAAcW,IAAd,CAAP;AACD;AACD,aAAOd,QAAQM,OAAR,CAAgBJ,QAAhB,CAAP;AACD;AAXW,GAAd;AAaA,SAAOU,OAAP;AACD,CAtCQ,EAAT;;AAwCAM,OAAOC,OAAP,GAAiBlB,EAAjB","file":"db.js","sourcesContent":["\n\nconst config = {\n  dbUrl: 'mongodb://restry:wanICE193gxLoYpYT7ttHtWPlSnoZ6o68es0l05MNHPsMvyyfnynMGLRZUHYnLiwOedLro0WUhSWZdVnzjzMyg%3D%3D@restry.documents.azure.cn:10255/?ssl=true',// 阿里外网\n  // dbUrl: 'mongodb://admin:teddi98fDFerr32@dds-2ze4140fda57f0341.mongodb.rds.aliyuncs.com:3717,dds-2ze4140fda57f0342.mongodb.rds.aliyuncs.com:3717/xtphoto?replicaSet=mgset-10875345', // 阿里内网连接\n\n}\n\nif (process.env.NODE_ENV === 'development') {\n  // config.dbUrl = 'mongodb://admin:Mongohere1@ali.windart.vip:28888/'\n  // config.dbUrl = 'mongodb://admin:teddi98fDFerr32@mgr.xtphoto.net:27017/'\n  config.dbUrl = 'mongodb://restry:wanICE193gxLoYpYT7ttHtWPlSnoZ6o68es0l05MNHPsMvyyfnynMGLRZUHYnLiwOedLro0WUhSWZdVnzjzMyg%3D%3D@restry.documents.azure.cn:10255/?ssl=true'\n}\n'use strict';\n\nconst mongoClient = require('mongodb').MongoClient;\nvar Promise = require(\"bluebird\");\n\nvar db = (function () {\n  //实例容器\n  var instance;\n\n  function Singleton(database) {\n    var url = config.dbUrl;\n    // console.log(`url:${url}`);\n    return new Promise((resolve, reject) => {\n      // Use connect method to connect to the Server\n\n      mongoClient.connect(url, { useNewUrlParser: true, useUnifiedTopology: true },\n        (err, db) => {\n          if (err) {\n            reject(err);\n            // console.log('db.serverStatus:', db.serverStatus())\n          } else {\n            instance = db.db(database);\n            resolve(instance, db);\n          }\n        });\n    });\n  }\n\n\n  var _static = {\n    name: 'SingletonDBConnection',\n\n    //获取实例的方法\n    //返回Singleton的实例\n    connect: function (args) {\n      if (instance === undefined) {\n        console.log(`instance not found: ${args}`);\n        return new Singleton(args);\n      }\n      return Promise.resolve(instance);\n    }\n  };\n  return _static;\n})();\n\nmodule.exports = db;\n"]}